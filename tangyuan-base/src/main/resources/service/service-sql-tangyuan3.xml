<?xml version="1.0" encoding="UTF-8"?>
<sqlservices xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="http://xson.org/schema/tangyuan/sql/service.xsd"
	ns="s1">

	<selectSet id="getRoleList" dsKey="readtvr" txRef="tx_01">
		select * from system_role
	</selectSet>

	<selectOne id="s2" dsKey="readtvr" txRef="tx_01"
		cacheUse="id:cache4; key:${service}${args}; expiry:10">
		select * from system_role where role_id = 1
	</selectOne>

	<sql-service id="s10" dsKey="readtvr" txRef="tx_01">
		<selectSet resultKey="{roleList}">
			select * from system_role
		</selectSet>
		<return>
			<property value="{roleList}" />
			<property name="{a}" value="1L" />
		</return>
	</sql-service>
	
	<delete id="deleteUserById" dsKey="readtvr" txRef="tx_02" cacheClean="id:cache1; key:${service}{user_id}">
		delete from user where user_id = #{user_id}	
	</delete>
	
	<sql-service id="s10" dsKey="readtvr" txRef="tx_01" group="" desc="">
		<selectSet resultKey="{userList}">
			select * from user
		</selectSet>
		<selectSet resultKey="{userDetailList}">
			select * from user_detail
		</selectSet>
		<merge 
			a="{userList}" b="{userDetailList}"
			aKey="user_id, user_name" bKey="user_id, user_name" 
			bInclude="" bExclude="" rule="{xxx}.m1"
		/>
		<!-- 
			1 -> 1
			m -> 1
			1 -> m
			
			a->b合并
			b->a合并
			a->b合并，部分追加
			b->a合并，部分追加
			
			{userDetailList} -> {userList}
			
			{userList[a,b,c]} -> userDetailList
		 -->
		<setvar key="" value="" type="int"/>
		<call service="a/b" resultKey="{x}" exResultKey="{err}" mode="EXTEND"/>
		<return>
			<property value="{roleList}" />
			<property name="{a}" value="1L" />
		</return>
	</sql-service>	

<!-- 			
<xs:attribute name="resultKey" type="xs:string"/>
<xs:attribute name="txRef" type="xs:string"/>
-->

	<!-- SQL命令 -->
	<selectSet-command id="getRoleList" resultKey="{xxx}" dsKey="readtvr" fetchSize="" cacheUse="">
		select * from abc
	</selectSet-command>
	<selectOne-command id="getRoleList" resultKey="{xxx}" dsKey="readtvr" cacheUse="">
		select * from abc limit 1
	</selectOne-command>
	<selectVar-command id="getRoleList" resultKey="{xxx}" dsKey="readtvr" cacheUse="">
		select name from abc limit 1
	</selectVar-command>
	<update-command id="getRoleList" rowCount="{xxx}" dsKey="readtvr" cacheClean="">
		update table set x = 2 where a = 3
	</update-command>
	<delete-command id="getRoleList" rowCount="{xxx}" dsKey="readtvr" cacheClean="">
		update table set x = 2 where a = 3
	</delete-command>
	<insert-command id="getRoleList" rowCount="{xxx}" incrementKey="{xxx}" dsKey="readtvr" cacheClean="">
		update table set x = 2 where a = 3
	</insert-command>
	
	<sql-command dsKey="readtvr" cacheUse="" cacheClean="">
		<selectSet-command resultKey="{xxx}" dsKey="readtvr" fetchSize="" cacheUse="">
			select * from abc
		</selectSet-command>
		<selectOne-command resultKey="{xxx}">
			select * from abc limit 1
		</selectOne-command>
		<selectVar-command resultKey="{xxx}">
			select name from abc limit 1
		</selectVar-command>
		<update-command rowCount="{xxx}">
			update table set x = 2 where a = 3
		</update-command>
		<delete-command rowCount="{xxx}">
			update table set x = 2 where a = 3
		</delete-command>
		<insert-command rowCount="{xxx}" incrementKey="{xxx}">
			update table set x = 2 where a = 3
		</insert-command>
		<!-- <sql-exec command="" resultKey="{xxx}" dsKey="readtvr" txRef="" /> -->
		
		<selectSet-command ref-command="a/b" resultKey="{xxx}" dsKey="readtvr" fetchSize="" cacheUse="" />
		
		<return>
			<property value="{roleList}" />
			<property name="{a}" value="1L" />
		</return>
	</sql-command>

</sqlservices>